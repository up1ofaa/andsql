-- distinct와 group by 차이
-- 값 차이 없음
-- 속도차이 distinct 가 더 빠름


SELECT  DISTINCT
		 C8.CLNT_ID||'-'||C8.CONT_NO||'-'||C8.BOND_SEQ
		,C8.CUST_ID
		,TMP.SEND_YMD
	 	,TMP.ANK
 FROM 	CA08MAIL C8
 		 ,(SELECT
 		 			DISTINCT
 		 			 CA08.CLNT_ID   AS CLNT_ID
 		 			,CA08.BOND_SEQ  AS BOND_SEQ
 		 			,CA08.CONT_NO   AS CONT_NO
 		 			,CA08.CUST_ID   AS CUST_ID
 		 			,CA08.SEND_YMD  AS SEND_YMD
 					,RANK() OVER  (PARTITION BY CA08.CLNT_ID, CA08.CUST_ID ORDER BY CA08.SEND_YMD) "ANK"
 			FROM CA08MAIL CA08,CA01BOND CA01, CA02RELN CA02
			WHERE 1=1
			AND CA01.CLNT_ID=CA02.CLNT_ID
			AND CA01.CONT_NO=CA02.CONT_NO
			AND CA01.BOND_SEQ=CA02.BOND_SEQ
			AND CA01.USE_YN=' '
			AND CA02.USE_YN=' '
			AND CA08.USE_YN=' '
			AND CA08.CNCL_YN = 'N'
			AND CA01.CLNT_ID IN('004','050','060','090','097')
			AND CA01.END_DIVI='00'
			AND CA01.TEAM_CODE='8050'
			AND CA08.CLNT_ID=CA02.CLNT_ID
			AND CA08.CONT_NO=CA02.CONT_NO
			AND CA08.BOND_SEQ=CA02.BOND_SEQ
			AND CA08.CUST_ID=CA02.CUST_ID
--			GROUP BY
--			 CA08.CLNT_ID
-- 		 			,CA08.BOND_SEQ
-- 		 			,CA08.CONT_NO
-- 		 			,CA08.CUST_ID
-- 		 			,CA08.SEND_YMD
 		 			) TMP
 WHERE    C8.USE_YN = ' '
 AND      C8.CLNT_ID =TMP.CLNT_ID
 AND 	  C8.CUST_ID=TMP.CUST_ID
 AND      C8.CONT_NO=TMP.CONT_NO
 AND 	  C8.BOND_SEQ=TMP.BOND_SEQ
 AND 	  C8.CNCL_YN = 'N'
 AND      TMP.ANK=2
 ;

--3872
--3979

 SELECT 			 DISTINCT
 		 			 CA08.CLNT_ID   AS CLNT_ID
 		 			,CA08.BOND_SEQ  AS BOND_SEQ
 		 			,CA08.CONT_NO   AS CONT_NO
 		 			,CA08.CUST_ID   AS CUST_ID
 		 			,CA08.SEND_YMD  AS SEND_YMD
 					,RANK() OVER  (PARTITION BY CA08.CLNT_ID, CA08.CUST_ID ORDER BY CA08.SEND_YMD) "ANK"
 			FROM CA08MAIL CA08,CA01BOND CA01, CA02RELN CA02
			WHERE 1=1
			AND CA01.CLNT_ID=CA02.CLNT_ID
			AND CA01.CONT_NO=CA02.CONT_NO
			AND CA01.BOND_SEQ=CA02.BOND_SEQ
			AND CA01.USE_YN=' '
			AND CA02.USE_YN=' '
			AND CA08.USE_YN=' '
			AND CA08.CNCL_YN = 'N'
			AND CA01.CLNT_ID IN('004','050','060','090','097')
			AND CA01.END_DIVI='00'
			AND CA01.TEAM_CODE='8050'
			AND CA08.CLNT_ID=CA02.CLNT_ID
			AND CA08.CONT_NO=CA02.CONT_NO
			AND CA08.BOND_SEQ=CA02.BOND_SEQ
			AND CA08.CUST_ID=CA02.CUST_ID
--			GROUP BY CA08.CLNT_ID
-- 		 			,CA08.BOND_SEQ
-- 		 			,CA08.CONT_NO
-- 		 			,CA08.CUST_ID
-- 		 			,CA08.SEND_YMD
			;
--21822
--21822
